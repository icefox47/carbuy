<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your Perfect Car</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('static/img/hero-bg.jpg');
            background-size: cover;
            background-position: center;
            min-height: 80vh;
            display: flex;
            align-items: center;
        }

        .feature-card {
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
        }

        .icon-circle {
            width: 80px;
            height: 80px;
            background-color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
        }

        .icon-circle i {
            font-size: 2rem;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">CarFinder</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="{{ url_for('index') }}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#features">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#how-it-works">How It Works</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-primary ms-lg-3" href="{{ url_for('car_form') }}">Find Your Car</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section text-white">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 mb-4 fw-bold">
                        Find Your <span class="gradient-highlight">Perfect Car</span> Match
                    </h1>
                    <p class="lead mb-5">Let us help you discover the ideal vehicle that matches your needs, preferences, and budget.</p>
                </div>
                <div class="col-lg-5 offset-lg-1">
                    <div class="search-card">
                        <h3 class="text-dark mb-4"><i class="fas fa-robot me-2 text-primary"></i>AI Car Match</h3>
                        <p class="text-muted mb-3">Describe your dream car (e.g., "Best SUV under 100k AED for family")</p>
                        <div class="form-group mb-3">
                            <textarea class="form-control" id="aiQuery" rows="3" placeholder="Type your requirements here..."></textarea>
                        </div>
                        <button type="button" class="btn btn-primary w-100 py-3" onclick="showUserForm()">
                            Find My Car <i class="fas fa-magic ms-2"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- User Details Modal -->
    <div class="modal fade" id="userDetailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">One Last Step!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Please provide your details so we can save your preferences and contact you with the best options.</p>
                    <form id="userForm">
                        <div class="mb-3">
                            <label for="userName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="userName" required>
                        </div>
                        <div class="mb-3">
                            <label for="userPhone" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="userPhone" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitAIQuery()">See Results</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal fade" id="resultsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">AI Recommendations</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="aiCriteria" class="alert alert-info mb-4" style="display:none;">
                        <!-- Criteria will be injected here -->
                    </div>
                    <div id="resultsContainer" class="row g-4">
                        <!-- Results will be injected here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showUserForm() {
            const query = document.getElementById('aiQuery').value;
            if (!query.trim()) {
                alert('Please describe the car you are looking for.');
                return;
            }
            const modal = new bootstrap.Modal(document.getElementById('userDetailsModal'));
            modal.show();
        }

        async function submitAIQuery() {
            const query = document.getElementById('aiQuery').value;
            const name = document.getElementById('userName').value;
            const phone = document.getElementById('userPhone').value;

            if (!name || !phone) {
                alert('Please fill in all fields.');
                return;
            }

            // Close user modal
            const userModalEl = document.getElementById('userDetailsModal');
            const userModal = bootstrap.Modal.getInstance(userModalEl);
            userModal.hide();

            // Show loading state (optional but good for UX)
            // ...

            try {
                const response = await fetch('/api/ai-search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        name: name,
                        phone: phone
                    })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    displayResults(result);
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while processing your request.');
            }
        }

        function displayResults(data) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '';

            // Show criteria
            const criteriaDiv = document.getElementById('aiCriteria');
            if (data.criteria) {
                criteriaDiv.style.display = 'block';
                criteriaDiv.innerHTML = `<strong>We understood:</strong> Looking for a ${data.criteria.condition || ''} ${data.criteria.make || ''} ${data.criteria.type || ''} ${data.criteria.year || ''} around ${data.criteria.budget || 'any budget'}.`;
            }

            if (data.recommendations && data.recommendations.length > 0) {
                data.recommendations.forEach(car => {
                    const carCard = `
                        <div class="col-md-6">
                            <div class="card h-100">
                                <img src="${car.image}" class="card-img-top" alt="${car.make} ${car.model}" style="height: 200px; object-fit: cover;">
                                <div class="card-body">
                                    <h5 class="card-title">${car.year} ${car.make} ${car.model}</h5>
                                    <p class="card-text text-primary fw-bold">AED ${car.price.toLocaleString()}</p>
                                    <ul class="list-unstyled small">
                                        <li><i class="fas fa-gas-pump me-2"></i>${car.fuel}</li>
                                        <li><i class="fas fa-cog me-2"></i>${car.transmission}</li>
                                        <li><i class="fas fa-road me-2"></i>${car.kms_driven}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `;
                    container.innerHTML += carCard;
                });
            } else {
                container.innerHTML = '<div class="col-12 text-center"><p>No specific matches found, but we have saved your inquiry and will contact you!</p></div>';
            }

            const resultsModal = new bootstrap.Modal(document.getElementById('resultsModal'));
            resultsModal.show();
        }
    </script>

    <!-- Features Section -->
    <section id="features" class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">Why Choose Us</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-body text-center p-4">
                            <div class="icon-circle">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <h4>Trusted Dealership Network</h4>
                            <p class="text-muted">Get access to quality cars from our partner dealerships you can trust.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-body text-center p-4">
                            <div class="icon-circle">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h4>Best Price Guarantee</h4>
                            <p class="text-muted">We negotiate with dealers to get you the best possible deal.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm feature-card">
                        <div class="card-body text-center p-4">
                            <div class="icon-circle">
                                <i class="fas fa-user-friends"></i>
                            </div>
                            <h4>Personal Help</h4>
                            <p class="text-muted">Your own car expert guides you from start to finish.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section id="how-it-works" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">How It Works</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="display-4 text-primary mb-3">1</div>
                        <h4>Tell Us What You Need</h4>
                        <p class="text-muted">Fill our simple form about your dream car and budget.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="display-4 text-primary mb-3">2</div>
                        <h4>We Find the Best Options</h4>
                        <p class="text-muted">Our experts search the market for cars that match your needs.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="display-4 text-primary mb-3">3</div>
                        <h4>We Connect You</h4>
                        <p class="text-muted">Get direct contact with dealers who have your perfect car.</p>
                    </div>
                </div>
            </div>

            <div class="text-center mt-5">
                <a href="{{ url_for('car_form') }}" class="btn btn-primary btn-lg">
                    Start Your Journey <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white mt-5">
        <div class="container py-4 text-center">
                    <p class="mb-3 mt-2">&copy; 2025 CarFinder. All rights reserved.</p>

                    <a href="#">
                      <i class="fa-brands fa-instagram m-3"></i>
                    </a>
                    <a href="#">
                    <i class="fa-brands fa-facebook m-3"></i>
                    </a>
                    <a href="#">
                    <i class="fa-brands fa-twitter m-3 "></i>
                    </a>
                    <a href="#">
                    <i class="fa-brands fa-linkedin m-3 "></i>
                    </a>
        </div> 
    </footer>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
